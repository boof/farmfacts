!!!
%html{ :xmlns => 'http://www.w3.org/1999/xhtml' }

  %head
    %title&= title
    = javascript_include_tag 'jquery-1.3.2', 'jquery/lazy-1.3', :cache => 'lazy-jquery'
    = javascript_include_tag 'farmfacts'
    = stylesheet_link_tag 'farmfacts'

    = stylesheet_link_tag '/javascripts/jquery/ui/smoothness/theme.css'
    = javascript_include_tag '/javascripts/jquery/ui-1.7.2.js'

    :javascript
      FarmFacts.initialize();
      $(function() {
        $('a.submit').
        after('<input type="submit" style="display: none;" />').
        hover(
          function() { $(this).addClass('ui-state-hover'); },
          function() { $(this).removeClass('ui-state-hover'); }
        ).
        click(
          function() { $(this).next('input').click(); }
        );
        $('a.cancel').
        hover(
          function() { $(this).addClass('ui-state-hover'); },
          function() { $(this).removeClass('ui-state-hover'); }
        ).
        click(
          function() { $(this).click(); }
        );
        $('#top')[0].menus = [];
        $('#top ul li.menu').each(function(n) {
          var anchor = $(this).find('a').get(0);
          var href = $(anchor).attr('href');
          if (href && href.substr(0, 1) == '#') {
            var position = $(anchor).position();
            position.top += $(anchor).height();

            var css = {
              'position':   'absolute',
              'left':       position.left,
              'top':        position.top,
              'border-top': '1px solid #333333',
              'padding':    '0 1.5em .5em 1em'
            };

            anchor.menu = $(href)
              .addClass('ui-helper-clearfix')
              .addClass('ui-corner-bottom')
              .addClass('ui-widget-content')
              .css(css);

            $('#top')[0].menus.push(anchor.menu);

            $(anchor).click(function(e) {
              $($('#top')[0].menus).each(function() { this.hide(); });
              $('.label', this).css({'background-color': '#708090', 'color': 'white'});
              this.menu.show();
              // other menus show open on hover, when this happens the other should be hidden
              // when a click somewhere else occurs the menu should be closed
            });
          }
        });
      });

  %body
    #top.ui-helper-clearfix

      %ul.left
        %li.menu
          - link_to '#system' do
            .label= t 'titles.default'
        %li#system.hidden
          %ul
            %li= link_to t('actions.system.about'), 'about_system_path'
            %li= link_to t('actions.system.preferences'), 'preferences_system_path'
            %li= link_to t('actions.system.restart'), 'restart_system_path'
            %li= link_to t('actions.system.stop'), 'stop_system_path'
            %li= link_to t('actions.login.forget'), destroy_login_path

        %li.menu
          - link_to '#current' do
            .bold.label= title
        %li#current.hidden
          %ul
            %li= link_to t('actions.protected.logins.new'), new_protected_login_path(:return_uri => request.request_uri)
            %li= link_to t('actions.protected.groups.new'), new_protected_group_path
            %li= link_to t('actions.print'), 'javascript: window.print();'

        %li.menu
          - link_to '#view' do
            .label= t 'nouns.view'
        %li#view.hidden
          %ul
            %li= link_to t('actions.protected.logins.index'), protected_logins_path
            %li= link_to t('actions.protected.groups.index'), protected_groups_path
            %li= link_to t('actions.protected.pages.index'), pages_path
            %li= link_to t('actions.refresh'), 'javascript: location.reload(true);'

      %ul.right
        %li
          .label= visitor.name
        %li
          .label.clock &nbsp;

    = yield
